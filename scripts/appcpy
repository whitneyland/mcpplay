#!/bin/bash
# appcpy - Copy the last built RiffMCP.app to Applications folder

set -e

# Change to the script's directory to ensure we're in the project root
cd "$(dirname "$0")/.."

echo "üîç Finding last built RiffMCP.app..."

# Get the path to the last built RiffMCP.app using xcodebuild
APP_PATH=$(xcodebuild -showBuildSettings -scheme RiffMCP -configuration Debug -quiet 2>/dev/null | grep "BUILT_PRODUCTS_DIR" | head -1 | cut -d= -f2 | xargs)/RiffMCP.app

if [ ! -d "$APP_PATH" ]; then
    echo "‚ùå Error: RiffMCP.app not found at $APP_PATH"
    echo "   Make sure you've built the project first with: xcodebuild -scheme RiffMCP"
    exit 1
fi

echo "üì¶ Found RiffMCP.app at: $APP_PATH"

# Remove existing app if it exists
if [ -d "/Applications/RiffMCP.app" ]; then
    echo "üóëÔ∏è  Removing existing RiffMCP.app from Applications..."
    rm -rf "/Applications/RiffMCP.app"
fi

# Copy the app to Applications
echo "üìã Copying RiffMCP.app to Applications..."
cp -R "$APP_PATH" "/Applications/"

# Verify the copy was successful
if [ -d "/Applications/RiffMCP.app" ]; then
    echo "‚úÖ Successfully copied RiffMCP.app to Applications folder"
else
    echo "‚ùå Error: Failed to copy RiffMCP.app to Applications folder"
    exit 1
fi